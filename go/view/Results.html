<!DOCTYPE html>

{{/*<!--
  ~ The MIT License (MIT)
  ~
  ~ Copyright (c) 2016.  Georg Beier. All rights reserved.
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  ~ SOFTWARE.
  -->*/}}

{{define "work_results"}}
<form id="resultsform" class="form-horizontal" data-toggle="validator" role="form" action="JavaScript:postResults()">
    <div class="ncontainer" style="padding-right: 15px;">
        {{template "registrationfields" .}}
        <h3 class="clearfix col-xs-offset-2 col-sm-offset-2 col-lg-offset-1" style="margin-top: 3em;">
            Ergebnisse des DAAD Stipendientests
        </h3>
        {{template "results_fields" .}}
    </div>
    <div class="col-xs-11 col-xs-offset-1" style="margin-top: 3em;">
        <button id="change-results" type="button" class="btn btn-default">Stammdaten berichtigen</button>
        <button id="submit-results" type="submit" class="btn btn-primary">Submit</button>
    </div>
</form>

<script type="text/javascript">
    // called when this html fragment is loaded,
    // so all element configurations can be done here
    $(document).ready(function () {
        // set action listener functions
        $('#change-results').click(enableCoreData);
        //$('#submit-results').click(postResults);
        // update validator after form load
        $('#resultsform').validator('update')
    });

    // enable all input fields
    function enableCoreData() {
        $('#resultsform input[disabled]').removeAttr("disabled");
        $('#resultsform select[disabled]').removeAttr("disabled");
        $('#change-results').attr('disabled', 'disabled');
    }

    function testFormValid(form) {
        return $(form).validator('validate').has('.has-error').length == 0;
    }

    function postResults() {
        enableCoreData();
        var formVars = $("#resultsform").serialize();
        //var valid = $("#resultsform").validator('validate').has('.has-error').length;
        var sid = $('#sresult').val();
        var idx = $('#sresult').prop('selectedIndex');
        $.post("/results/submit", formVars, function() {
            $('option[value="'+sid+'"]').remove();
            var l = $('#sresult').children('option').length;
            // goto next in list
            if(l > idx) {
                $('#sresult').prop('selectedIndex', idx);
            // else goto prev or empty
            } else {
                $('#sresult').prop('selectedIndex', idx - 1);
            }
            if(l > 0) {
                var selid = $('#sresult').val();
                $("#examarea").load("/results/show", {appid: selid, action: actTab});
            } else {
                $('#examarea').html("");
            }
        });

    }
</script>
{{end}}

{{define "results_fields"}}
{{range $idx, $val := .results}}
<label for="r{{$idx}}" class="control-label col-xs-offset-2 col-sm-offset-0 col-xs-2 col-sm-2 col-md-2 col-lg-1">
    ({{$val.no}}):
</label>
<div class="form-group col-xs-8 col-sm-4 col-md-4 col-lg-3">
    <div class="input-group" title="Punkte: 0, 0.5, 1, ... , {{$val.max}}">
        <span class="input-group-addon"><span class="glyphicon glyphicon-certificate"></span></span>
        <input type="number" class="form-control" value="{{$val.val}}" id="r{{$idx}}"
               step="0.5" name="r{{$idx}}" min="0" max="{{$val.max}}" style="width: 5em">
    </div>
    <div class="help-block with-errors"></div>
</div>
{{end}}
<div class="clearfix"></div>
<label for="languageresult" class="control-label col-xs-offset-2 col-sm-offset-0 col-xs-2 col-sm-2 col-md-2 col-lg-1">
    Text
</label>
<div class="form-group col-xs-8 col-sm-4 col-md-4 col-lg-3">
    <div class="input-group" title="Note: 0 ... 5, eine Kommastelle">
        <span class="input-group-addon"><span class="glyphicon glyphicon-file"></span></span>
        <input type="text" class="form-control" value="{{.languageresult}}" id="languageresult"
               pattern="5|(([0-4])+([.,]\d){0,1})" style="width: 5em">
    </div>
    <div class="help-block with-errors"></div>
</div>
<label for="languages" class="control-label col-xs-offset-2 col-sm-offset-0 col-xs-2 col-sm-2 col-md-2 col-lg-1">
    Sprache
</label>
<div class="col-xs-5 col-sm-3 col-md-2 col-lg-2">
    <div class=" form-group input-group">
        <span class="input-group-addon"><span class="glyphicon glyphicon-list-alt"></span></span>
        <select class="form-control" value="{{.language}}" id="languages" name="languages">
            {{ range $key, $val := .languages }}
            <option value="{{$key}}" {{if eq $key $.language}} selected="true" {{end}}>{{$val}}</option>
            {{end}}
        </select>
    </div>
</div>

{{end}}